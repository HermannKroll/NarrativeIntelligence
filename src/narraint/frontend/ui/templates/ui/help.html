{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/help.css' %}">
{% endblock %}

{% block title %}Help{% endblock %}

{% block content %}


    <div class="container margin-top">
        <h2>Team and Collaborators</h2>
        <div class="container">
            <div class="row">
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/hermann.png" alt="Hermann Kroll">
                        <div class="description">
                            <p class="name-text">Hermann Kroll</p>
                            <p>Computer Scientist</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/tilo.png" alt="Prof. Dr. Wolf-Tilo Balke">
                        <div class="description">
                            <p class="name-text">Wolf-Tilo Balke</p>
                            <p>Professor</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/christina.jpg" alt="Christina Draheim">
                        <div class="description">
                            <p class="name-text">Christina Draheim</p>
                            <p>Pharmacist</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/stefan.jpg" alt="Stefan Wulle">
                        <div class="description">
                            <p class="name-text">Stefan Wulle</p>
                            <p>Pharmacist</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/johannes.png" alt="Johannes Ruthmann">
                        <div class="description">
                            <p class="name-text">Johannes Ruthmann</p>
                            <p>Research Assistant</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/jan.jpg" alt="Jan Pirklbauer">
                        <div class="description">
                            <p class="name-text">Jan Pirklbauer</p>
                            <p>Research Assistant</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/morris.jpg" alt="Morris Kunz">
                        <div class="description">
                            <p class="name-text">Morris Kunz</p>
                            <p>Research Assistant</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/pascal.png" alt="Pascal Sackhoff">
                        <div class="description">
                            <p class="name-text">Pascal Sackhoff</p>
                            <p>Research Assistant</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="team-member">
                        <img src="../../static/assets/team/matthias.png" alt="Bill Matthias Thang">
                        <div class="description">
                            <p class="name-text">Bill Matthias Thang</p>
                            <p>Research Assistant</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <h2>Content</h2>
        The service contains abstracts from PubMed. In brief, everything that can be found
        by a PubMed search can also be found in our system.
        In addition, we included COVID 19 pre-prints from the
        <a href="https://preview.zbmed.de">ZB MED Preview Service</a>.
        <br>
        <div class="row gx-2">
            <div class="col-12 col-xxl-4 border">
                <h5 class="text-center">Documents per Collection</h5>
                <div class="pie-chart-height">
                    <canvas id="chart-collections"></canvas>
                </div>
            </div>
            <div class="col-12 col-xxl-4 border">
                <h5 class="text-center">Entities/Concepts per Type</h5>
                <div class="pie-chart-height">
                    <canvas id="chart-entity_types"></canvas>
                </div>
            </div>
            <div class="col-12 col-xxl-4 border">
                <h5 class="text-center">Extracted Statements per Relation</h5>
                <div class="pie-chart-height">
                    <canvas id="chart-relations"></canvas>
                </div>
            </div>
        </div>


        <h2>Content Information</h2>
        <div class="row">
            <div class="col">
                <table id="help_table" class="table table-bordered">
                    <thead>
                    <tr>
                        <th scope="col" data-sortable="true">Concept Type</th>
                        <th scope="col" data-sortable="true">Source</th>
                        <th scope="col" data-sortable="true">Description</th>
                    </tr>
                    </thead>
                    <tbody id="help_table_body">
                    <tr>
                        <td>Chemical</td>
                        <td><a href="https://www.ebi.ac.uk/chembl/">ChEMBL</a>
                        </td>
                        <td>general chemicals</td>
                    </tr>
                    <tr>
                        <td>Drug</td>
                        <td><a href="https://www.ebi.ac.uk/chembl/">ChEMBL</a>
                        </td>
                        <td>active ingredients/drug/substances (no trade names)</td>
                    </tr>
                    <tr>
                        <td>Disease</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/mesh/">MeSH</a></td>
                        <td>diseases, symptoms, side effects</td>
                    </tr>
                    <tr>
                        <td>Dosage Form</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/mesh/">MeSH</a> + Custom
                        </td>
                        <td>forms in which a drug is administered / bound</td>
                    </tr>
                    <tr>
                        <td>Excipient</td>
                        <td>Custom
                        </td>
                        <td>ingredients / chemicals that are used in dosage forms</td>
                    </tr>
                    <tr>
                        <td>HealthStatus</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/mesh/">MeSH</a>
                        </td>
                        <td>Status for patients (women, men, alcoholics, ...)</td>
                    </tr>
                    <tr>
                        <td>Method</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/mesh/">MeSH</a>
                        </td>
                        <td>general methods for investigation</td>
                    </tr>
                    <tr>
                        <td>LabMethod</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/mesh/">MeSH</a>
                        </td>
                        <td>manually selected subset of Methods that are classfied as labor relevant methods</td>
                    </tr>
                    <tr>
                        <td>PlantFamiliy/Genus</td>
                        <td><a href="https://www.wikidata.org/wiki/Wikidata:Main_Page">Wikidata</a>
                        </td>
                        <td>Plants (Families, Genus). Additional Cleaning is performed.</td>
                    </tr>
                    <tr>
                        <td>Target</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/gene">NCBI Genes</a>
                        </td>
                        <td>Pharmaceutical Targets (proteases, lactamase, ...)</td>
                    </tr>
                    <tr>
                        <td>Vaccine</td>
                        <td><a href="https://www.ncbi.nlm.nih.gov/mesh/">MeSH</a>
                        </td>
                        <td>Vaccines for different diseases</td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>

        <h2>Interactions</h2>

        <div class="row">
            <div class="col">
                <table id="help_table" class="table table-bordered">
                    <thead>
                    <tr>
                        <th scope="col" data-sortable="true">Interaction</th>
                        <th scope="col" data-sortable="true">Explanation</th>
                    </tr>
                    </thead>
                    <tbody id="help_table_body">
                    <tr>
                        <td>associated</td>
                        <td>The general relation associated describes that two concepts are mentioned within the same
                            sentence and connected via a verb/keyword.
                        </td>
                    </tr>
                    <tr>
                        <td>administered</td>
                        <td>Administered describes that some substance (Chemical, Drug, Excipient or Plant Family) is
                            given in a dosage dorm (tablet, injection, etc.).
                        </td>
                    </tr>
                    <tr>
                        <td>compares</td>
                        <td>Compares describes that some concepts are compared.</td>
                    </tr>
                    <tr>
                        <td>decreases</td>
                        <td>Decreases describes that some effect is lowered, e.g., a drug might lower the expression of
                            some target. A search for decreases also includes searches for the inhibits relation.
                        </td>
                    </tr>
                    <tr>
                        <td>induces</td>
                        <td>Induces describes that some effect / expression is increased, e.g., a drug might increase
                            the expression of a disease. Induces may be used to search for side effects.
                        </td>
                    </tr>
                    <tr>
                        <td>interacts</td>
                        <td>Interacts describe an interaction between concepts (drugs, targets, etc.). A search for
                            interacts
                            also includes searches for metabolises and inhibits.
                        </td>
                    </tr>
                    <tr>
                        <td>inhibits</td>
                        <td>Inhibits describes an inhibition of some target, e.g., a drug might inhibit some target.
                        </td>
                    </tr>
                    <tr>
                        <td>metabolises</td>
                        <td>Metabolises describes that a target is metabolised by some substance, e.g., a drug might be
                            metabolised by a target.
                        </td>
                    </tr>
                    <tr>
                        <td>method</td>
                        <td>Method describes a relation that involves a method or lab method, e.g., a drug might be
                            analysed via a method.
                        </td>
                    </tr>
                    <tr>
                        <td>treats</td>
                        <td>Treats describe that some disease or species is treated with a substance (Chemical, Drug,
                            Excipient), e.g., a drug might prevent or lower the expression of some disease.
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>

        <h2>Synonyms for Interactions</h2>
        <p>
            The following table displays which regular expressions and synonyms we consider to represent an interaction.
            We
            also
            provide this list as a <a
                href="https://github.com/HermannKroll/KGExtractionToolbox/blob/main/resources/cleaning/pharm_relation_vocab.json">JSON
            file</a>.
        </p>

        <div class="row">
            <div class="col">
                <table id="help_table" class="table table-bordered">
                    <thead>
                    <tr>
                        <th scope="col" data-sortable="true">Interaction</th>
                        <th scope="col" data-sortable="true">Explanation</th>
                    </tr>
                    </thead>
                    <tbody id="help_table_body">
                    <tr>
                        <td>associated</td>
                        <td>General relation. Any predicate and those special words:
                            associat*, contain, produce, convert, yield, isolate, generate, synthesize, grow, occures,
                            evaluat*, augment, effect, develop*, affect, contribut*, involve, isa, same as, coexists
                            with, process, part of, associate, play, limit, show, present, exhibit, find, form
                        </td>
                    </tr>
                    <tr>
                        <td>administered</td>
                        <td>Relation between Dosage Forms and any other concept. receiv*, administrat*
                        </td>
                    </tr>
                    <tr>
                        <td>compares</td>
                        <td>compar*, correlate*, correspond*</td>
                    </tr>
                    <tr>
                        <td>decreases</td>
                        <td>reduc*, lower*, attenuat*, mediate, downregulat*, down-regulat*, down regulat*
                        </td>
                    </tr>
                    <tr>
                        <td>induces</td>
                        <td>stimulat*, increas*, potentiat*, enhanc*, activat*, lead, cause, side effect*, adverse,
                            complication*, drug toxicit*, drug injur*, upregulat*, up regulat*, up-regulat*
                        </td>
                    </tr>
                    <tr>
                        <td>interacts</td>
                        <td>bind, interact*, target*, regulat*, block*
                        </td>
                    </tr>
                    <tr>
                        <td>inhibits</td>
                        <td>disrupt*, suppres*, inhibit*, disturb*
                        </td>
                    </tr>
                    <tr>
                        <td>metabolises</td>
                        <td>metabol*
                        </td>
                    </tr>
                    <tr>
                        <td>method</td>
                        <td>Relation between Methods and any other concept. method*
                        </td>
                    </tr>
                    <tr>
                        <td>treats</td>
                        <td>prevent*, use, improv*, promot*, sensiti*, aid, treat*, *therap*
                        </td>
                    </tr>

                    </tbody>
                </table>
            </div>
        </div>

        <h2>Interaction Hierarchy</h2>
        <p>
            The following hierarchy displays how interactions are expanded in our system, e.g., associated is
            expanded to any other relation or interacts is expanded to inhibits or metabolises.
        </p>

        <ul>
            <li>
                associated
                <ul>
                    <li>
                        administered
                    </li>
                    <li>
                        compares
                    </li>
                    <li>
                        decreases
                        <ul>
                            <li>inhibits</li>
                        </ul>
                    </li>
                    <li>
                        induces
                    </li>
                    <li>
                        interacts
                        <ul>
                            <li>inhibits</li>
                            <li>metabolises</li>
                        </ul>
                    </li>
                    <li>
                        treats
                    </li>
                    <li>
                        method
                    </li>
                </ul>
            </li>
        </ul>
    </div>

{% endblock %}

{% block javascript %}
    <script src="{% static 'js/../../static/js/../../static/js/libraries/Chart.min.js' %}"></script>
    <script type="text/javascript">
        const URL_CONTENT_CHART_DATA = "{% url "content_data" %}";
        $("#nav_item_search").removeClass("active");
        $("#nav_item_help").addClass("active");
        // $("#nav_item_stats").removeClass("active");
        loadChartData();

        async function loadChartData() {
            const data = await fetch(URL_CONTENT_CHART_DATA)
                .then(response => {
                    if (!response.ok)
                        return {};

                    return response.json();
                })
                .catch(_ => console.error("Could not load chart data."));

            createChart("collections", data["collections"]);
            createChart("entity_types", data["entity_types"], true);
            createChart("relations", data["relations"]);
        }


        function createChart(suffix, chartData, useColorMap = false) {
            const labels = [];
            const data = [];
            const colors = [];

            let other_data = 0;
            let color_index = 0;
            for (const [key, value] of Object.entries(chartData)) {
                if (useColorMap) {
                    if (key in TYPE_COLOR_MAP) {
                        colors.push(TYPE_COLOR_MAP[key]);
                    } else {
                        // just increment the 'other' value and skip insertion
                        other_data += value;
                        continue
                    }
                } else {
                    colors.push(Object.entries(TYPE_COLOR_MAP)[color_index][1]);
                    color_index += 1;
                }
                labels.push(key + " (" + value + ")");
                data.push(value);
            }

            // merge unknown types into other-class
            if (useColorMap && other_data > 0) {
                colors.push(TYPE_COLOR_MAP["Other"]);
                labels.push("Other (" + other_data + ")");
                data.push(other_data);
            }

            const element = document.getElementById("chart-" + suffix);

            new Chart(element, {
                type: "pie",
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors,
                        borderWidth: 1,
                    }],
                },
                options: {
                    maintainAspectRatio: false,
                    responsive: true,
                    tooltips: {
                        callbacks: {
                            label: function (tooltipItem, data) {
                                return data.labels[tooltipItem.index] || '';
                            }
                        }
                    },
                    legend: {
                        display: true,
                        position: "right",
                        labels: {usePointStyle: true, font: {size: 16}}
                    }
                }
            });
        }
    </script>
{% endblock %}
