{% extends 'base.html' %}
{% load static %}

{% block css %}
    <link rel="stylesheet" href="{% static 'css/../../static/css/../../static/css/ui.css' %}" type="text/css"/>
    <link rel="stylesheet" href="{% static 'css/../../static/css/../../static/css/network.css' %}" type="text/css"/>

    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/resources/demos/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css"/>
    <link href="https://unpkg.com/vis-network@latest/dist/vis-network.min.css" rel="stylesheet" type="text/css"/>
{% endblock %}

{% block title %}Narrative Information Access to PubMed{% endblock %}

{% block content %}


    <input type="file" id="tFile" style="display: none;" onchange=load()></input>
    <div id="App">
        <div class="help-tip">
            <p>- Click and hold on free space to add a node <br>
                - Click and drag from one node to another to add an edge <br>
                - Click on node to select it <br>
                - Click the "Center-Button" to center your network <br>
                - Click the "Clear-Button" to delete the network <br>
                - To select multiple nodes, click and hold each node <br>
                - Select multiple nodes to Cluster them <br>
                - Press backspace to delete nodes <br></p>
        </div>

        <a id="mod1" onClick="network.unselectAll();" href="#ex2" rel="modal:open" style="display: none">Open Modal</a>
        <a id="mod2" onClick="network.unselectAll();" href="#edgemod" rel="modal:open" style="display: none">Open
            Modal</a>
        <a id="mod3" onClick="network.unselectAll();" href="#renamemod" rel="modal:open" style="display: none">Open
            Modal</a>
        <a id="mod4" onClick="network.unselectAll();" href="#renameedgemod" rel="modal:open" style="display: none">Open
            Modal</a>
        <a id="mod5" onClick="network.unselectAll();" href="#renamecluster" rel="modal:open" style="display: none">Open
            Modal</a>
        <input type="textarea" name="fileName" id="tFileName" onClick="network.unselectAll();" class="input fileName"
               placeholder="Name der Datei" style="padding-top: 10px;padding-bottom: 10px;">
        <input type='file' onChange=load() id="tFile" style="display: none"/>

        <div id="mynetwork" onchange="createQuery();console.log(query + " onchange
        ");">
    </div>
    <button class="button" id="cluster" onClick=clusterSelected()></button>
    <button class="button" id="load" onClick="document.getElementById('tFile').click();"></button>
    <button class="button" id="save" onClick=save()></button>
    <button class="button" id="undo" onClick=undo()></button>
    <button class="button" id="redo" onClick=redo()></button>
    <button class="button" id="center" onClick=centerNetwork()></button>
    <button class="button" id="clear" onClick=clear_all()></button>



    </div>
    <form action="" class="login_form modal" id="ex2" style="display: none;">
        <h3>neuen Knoten benennen</h3>
        <p><label>Knotenname: </label><input id="inpnode" type="text"></p>
        <label>Knotentyp: </label>
        <select id="newNodeType" disabled>
            <option value="Any" selected="selected">Any</option>
            <option value="Drug">Drug</option>
            <option value="Disease">Disease</option>
            <option value="Gene">Gene</option>
            <option value="Species">Species</option>
            <option value="Mutation">Mutation</option>
            <option value="CellLine">CellLine</option>
        </select>
        <br></br>
        <input id="checknode" type="checkbox">Literal?</input>
        <br></br>
        <a id="btnsub" onclick="dialogNameNode()" href="#close-modal" rel="modal:close">OK</a>
        <a href="#close-modal" rel="modal:close">Cancel</a>
    </form>

    <form action="" class="login_form modal" id="edgemod" style="display: none;">
        <h3>neue Kante benennen</h3>
        <p><label>Kantenname: </label><input id="inpedge" type="text"></p>
        <a id="btnsubedge" onclick="dialogNameEdge()" href="#close-modal" rel="modal:close">OK</a>
        <a href="#close-modal" rel="modal:close">Cancel</a>
    </form>

    <form action="" class="login_form modal" id="renameedgemod" style="display: none;">
        <h3>Kante umbenennen</h3>
        <p><label>Kantenname: </label><input id="inprenameedge" type="text"></p>
        <a id="btnsubrenameedge" onclick="dialogRenameEdge()" href="#close-modal" rel="modal:close">OK</a>
        <a href="#close-modal" rel="modal:close">Cancel</a>
    </form>

    <form action="" class="login_form modal" id="renamecluster" style="display: none;">
        <h3>Cluster umbenennen</h3>
        <p><label>Clustername: </label><input id="inprenamecluster" type="text"></p>
        <a id="btnsubrenamecluster" onclick="dialogRenameCluster()" href="#close-modal" rel="modal:close">OK</a>
        <a href="#close-modal" rel="modal:close">Cancel</a>
    </form>

    <form action="" class="login_form modal" id="renamemod" style="display: none;">
        <h3>neuen Namen eingeben</h3>
        <p><label>Knotenname:</label><input id="inprename" type="text"></p>
        <label>Knotentyp: </label>
        <select id="RenameNodeType" disabled>
            <option value="Any" selected="selected">Any</option>
            <option value="Drug">Drug</option>
            <option value="Disease">Disease</option>
            <option value="Gene">Gene</option>
            <option value="Species">Species</option>
            <option value="Mutation">Mutation</option>
            <option value="CellLine">CellLine</option>
        </select>
        <br></br>
        <input id="checkrename" type="checkbox">Literal?</input>
        <br></br>
        <a id="btnsubrename" onclick="dialogReName()" href="#close-modal" rel="modal:close">OK</a>
        <a href="#close-modal" rel="modal:close">Cancel</a>
    </form>




    <!-- own development starts here: -->


    <div class="container margin-top">
        <div class="row">
            <div class="col">
                 <div class="help-tip">
                    <p> - Please type in the keywords you want to query <br>
                        - Currently, only entities in Mesh are supported. They can be entered by as a keyword or as a Mesh Identifier (beginning with MESH:): Simvastatin or MESH:DD019821 <br>
                        - Entities including empty spaces must be encoded like follows: Cytochrome_P-450_CYP3A or Diabetes_Mellitus <br>
                        - Predicates must stem from a predifined set of predicates (see below) <br>
                        - You can also use variables in your query by adding a question mark, e.g. Simvastatin CAUSES ?X <br>
                        - Multiple facts are queried as follows (seperated by a ';'): Simvastatin CAUSES ?X; ?X AFFECTS ?<br>
                </div>
                <form action="{% url 'search' %}" id="search_form">
                    {% csrf_token %}
                    <div class="form-group">
                        <label for="id_keywords"><strong>Keywords</strong></label>
                        <textarea class="form-control" id="id_keywords" rows="3"
                                  name="keywords">Simvastatin CAUSES Rhabdomyolysis</textarea>

                        <label for="id_keywords"><strong> Allowed Predicates:</strong></label>
                        <small id="id_help_2" class="form-text text-muted" aria-describedby="id_help">
                            'ADMINISTERED_TO', 'AFFECTS', 'ASSOCIATED_WITH', 'AUGMENTS', 'CAUSES', 'COEXISTS_WITH',
                            'COMPLICATES', 'CONVERTS_TO', 'DIAGNOSES', 'DISRUPTS', 'INHIBITS', 'INTERACTS_WITH', 'ISA',
                            'LOCATION_OF', 'MANIFESTATION_OF', 'METHOD_OF', 'NEG_ADMINISTERED_TO', 'NEG_AFFECTS',
                            'NEG_ASSOCIATED_WITH', 'NEG_AUGMENTS', 'NEG_CAUSES', 'NEG_COEXISTS_WITH', 'NEG_COMPLICATES',
                            'NEG_CONVERTS_TO', 'NEG_DIAGNOSES', 'NEG_DISRUPTS', 'NEG_INHIBITS', 'NEG_INTERACTS_WITH',
                            'NEG_LOCATION_OF', 'NEG_MANIFESTATION_OF', 'NEG_METHOD_OF', 'NEG_OCCURS_IN', 'NEG_PART_OF',
                            'NEG_PRECEDES', 'NEG_PREDISPOSES', 'NEG_PREVENTS', 'NEG_PROCESS_OF', 'NEG_PRODUCES',
                            'NEG_STIMULATES', 'NEG_TREATS', 'NEG_USES', 'NEG_higher_than', 'NEG_lower_than',
                            'OCCURS_IN', 'PART_OF', 'PRECEDES', 'PREDISPOSES', 'PREVENTS', 'PROCESS_OF', 'PRODUCES',
                            'STIMULATES', 'TREATS', 'USES', 'compared_with', 'different_from', 'higher_than',
                            'lower_than', 'same_as'
                        </small>
                        <label for="id_keywords"><strong>Corpus:</strong></label>

                        <small id="id_help_3" class="form-text text-muted" aria-describedby="id_help">
                            Current Corpus: SemMedDB 06.2019 (PubMed Abstracts + Titles, 31.12.2018)
                        </small>
                    </div>
                    <button type="submit" class="btn btn-primary" id="btn_search">
                        Search patterns
                    </button>
                    <p id="help_search" class="form-text text-muted" aria-describedby="btn_search">
                        Please be patient. This process can take up to one minute.
                    </p>
                </form>
            </div>
            <div class="col">
                <label for="query_translation"><strong>Query Translation</strong></label>
                <div id="query_translation">No query translation available.</div>
            </div>
        </div>

        <div class="row margin-top">
            <div class="col">
                <h2>Graph patterns</h2>

                <form id="graph-patterns"></form>
            </div>
        </div>

        <div class="row margin-top" id="div_wrapper_documents">
            <div class="col-md-6">
                <h2>Documents</h2>

                <div id="div_documents"></div>
            </div>
        </div>

    </div>
{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="https://unpkg.com/vis-network@latest/dist/vis-network.min.js"></script>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cytoscape/3.7.2/cytoscape.umd.js"
            type="text/javascript"></script>
    <script type="text/javascript">
        const search_url = "{% url 'search' %}";
    </script>
    <script src="{% static 'js/../../static/js/../../static/js/search.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/../../static/js/../../static/js/network.js' %}" type="text/javascript"></script>
{% endblock %}